import PIL
from PIL import Image
import PIL.ImageTk
import ChessGameElements as chess
import GUI as gui
import tkinter as tk
import time


def initialize_board():
    gui_board = gui.GameBoard(root)
    piece_size = int(gui_board.get_size() * 0.8)
    gui_board.pack(side="top", fill="both", expand="true", padx=4, pady=4)
    counter = 0
    for pos in state_board:
        piece = state_board[pos]
        if piece is not None:
            image_name = piece.color + piece.kind
            image_file = PIL.Image.open("./icons/" + image_name + ".PNG")
            image_file = image_file.resize((piece_size, piece_size), Image.ANTIALIAS)

            # A new variable has to be created for every piece
            globals()['chess_piece%s' % counter] = PIL.ImageTk.PhotoImage(image_file)
            position = piece.get_position()
            (vec_pos_f, vec_pos_r) = position.to_vec()
            piece_name = image_name + str(counter)
            gui_board.addpiece(piece_name, globals()['chess_piece%s' % counter], vec_pos_f, vec_pos_r)
            counter += 1
    root.mainloop()


if __name__ == "__main__":
    game = chess.Game()
    root = tk.Tk()
    state_board = game.get_game_board()
    initialize_board()

    # Example move, Pawn from A2 to A4
    game.move_piece(chess.Position('A', 2), chess.Position('A', 4))
    # We need some way to update the board.
